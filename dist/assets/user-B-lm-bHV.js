import{e as b}from"./index-CAiBCleG.js";const H=e=>{let n;const t=new Set,o=(l,c)=>{const d=typeof l=="function"?l(n):l;if(!Object.is(d,n)){const I=n;n=c??(typeof d!="object"||d===null)?d:Object.assign({},n,d),t.forEach(g=>g(n,I))}},a=()=>n,u={setState:o,getState:a,getInitialState:()=>f,subscribe:l=>(t.add(l),()=>t.delete(l))},f=n=e(o,a,u);return u},R=(e=>e?H(e):H),E=e=>e;function P(e,n=E){const t=b.useSyncExternalStore(e.subscribe,b.useCallback(()=>n(e.getState()),[e,n]),b.useCallback(()=>n(e.getInitialState()),[e,n]));return b.useDebugValue(t),t}const O=e=>{const n=R(e),t=o=>P(n,o);return Object.assign(t,n),t},x=(e=>e?O(e):O);function C(e,n){let t;try{t=e()}catch{return}return{getItem:a=>{var s;const h=f=>f===null?null:JSON.parse(f,void 0),u=(s=t.getItem(a))!=null?s:null;return u instanceof Promise?u.then(h):h(u)},setItem:(a,s)=>t.setItem(a,JSON.stringify(s,void 0)),removeItem:a=>t.removeItem(a)}}const _=e=>n=>{try{const t=e(n);return t instanceof Promise?t:{then(o){return _(o)(t)},catch(o){return this}}}catch(t){return{then(o){return this},catch(o){return _(o)(t)}}}},F=(e,n)=>(t,o,a)=>{let s={storage:C(()=>window.localStorage),partialize:r=>r,version:0,merge:(r,S)=>({...S,...r}),...n},h=!1,u=0;const f=new Set,l=new Set;let c=s.storage;if(!c)return e((...r)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...r)},o,a);const d=()=>{const r=s.partialize({...o()});return c.setItem(s.name,{state:r,version:s.version})},I=a.setState;a.setState=(r,S)=>(I(r,S),d());const g=e((...r)=>(t(...r),d()),o,a);a.getInitialState=()=>g;let v;const w=()=>{var r,S;if(!c)return;const p=++u;h=!1,f.forEach(i=>{var m;return i((m=o())!=null?m:g)});const y=((S=s.onRehydrateStorage)==null?void 0:S.call(s,(r=o())!=null?r:g))||void 0;return _(c.getItem.bind(c))(s.name).then(i=>{if(i)if(typeof i.version=="number"&&i.version!==s.version){if(s.migrate){const m=s.migrate(i.state,i.version);return m instanceof Promise?m.then(k=>[!0,k]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,i.state];return[!1,void 0]}).then(i=>{var m;if(p!==u)return;const[k,j]=i;if(v=s.merge(j,(m=o())!=null?m:g),t(v,!0),k)return d()}).then(()=>{p===u&&(y?.(v,void 0),v=o(),h=!0,l.forEach(i=>i(v)))}).catch(i=>{p===u&&y?.(void 0,i)})};return a.persist={setOptions:r=>{s={...s,...r},r.storage&&(c=r.storage)},clearStorage:()=>{c?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>w(),hasHydrated:()=>h,onHydrate:r=>(f.add(r),()=>{f.delete(r)}),onFinishHydration:r=>(l.add(r),()=>{l.delete(r)})},s.skipHydration||w(),v||g},J=F,U=x()(J((e,n)=>({user:null,token:null,setUser:t=>e({user:t}),setToken:t=>e({token:t}),logout:()=>e({user:null,token:null}),isAuthenticated:()=>!!n().token,hasPermission:t=>{const{user:o}=n();return o?.permissions.includes(t)||!1}}),{name:"user-storage"}));export{U as u};
