import{r,u as E,m as z,j as t}from"./index-CAiBCleG.js";import{m as x}from"./mock-rGEZ3HGA.js";import{F as i,B as u,I as g,s as j}from"./index-swGlYUjQ.js";import{I as H}from"./index-DBy6f6Xv.js";import{P as M,b as _}from"./Table-tBS6Uq_V.js";import{R as A}from"./PlusOutlined-gP3SYvho.js";import{M as y}from"./index-D_huDtZH.js";import{S as v}from"./Table-C_qFrlVF.js";import{T as B}from"./index-BQP3PySm.js";import{R as L}from"./DeleteOutlined-DoB47LX8.js";import"./index-DQfW_aVs.js";import"./context-Z3YCD4ih.js";import"./CloseOutlined-HWTcD8NI.js";import"./index-rppOOmUr.js";import"./EllipsisOutlined-DhqJwpys.js";import"./index-D6x7_msS.js";import"./index-ycXrrK2V.js";var $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};function m(){return m=Object.assign?Object.assign.bind():function(l){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(l[o]=a[o])}return l},m.apply(this,arguments)}const q=(l,n)=>r.createElement(H,m({},l,{ref:n,icon:$})),V=r.forwardRef(q),le=()=>{const l=E(),[n]=z(),a=n.get("projectId"),o=r.useRef(null),[c]=i.useForm(),[I,d]=r.useState(!1),[p,h]=r.useState(null),[f,w]=r.useState([]),[b,k]=r.useState([]);r.useEffect(()=>{(async()=>{const s=await x.getTasks(),D=await x.getProjects();w(s),k(D)})()},[]);const T=()=>{h(null),c.resetFields(),d(!0)},S=e=>{h(e),c.setFieldsValue(e),d(!0)},F=async()=>{y.confirm({title:"确认删除",content:"确定要删除该任务吗？",onOk:async()=>{j.success("删除成功"),o.current?.reload()}})},C=async()=>{try{await c.validateFields(),j.success(p?"更新成功":"创建成功"),d(!1),o.current?.reload()}catch(e){console.error("Validation failed:",e)}},R=e=>({todo:"default",in_progress:"blue",completed:"green",cancelled:"red"})[e]||"default",O=e=>({todo:"待处理",in_progress:"进行中",completed:"已完成",cancelled:"已取消"})[e]||e,P=[{title:"序号",dataIndex:"id",valueType:"index",width:60,align:"center"},{title:"任务名称",dataIndex:"name",width:200,render:e=>t.jsx("a",{style:{color:"#1677FF"},children:e})},{title:"计划工时",dataIndex:"planHours",width:100,valueType:"digit",render:e=>t.jsxs("span",{style:{fontWeight:600},children:[e,"h"]})},{title:"已消耗工时",dataIndex:"consumedHours",width:100,valueType:"digit",render:e=>t.jsxs("span",{style:{color:"#FA8C16"},children:[e,"h"]})},{title:"剩余工时",dataIndex:"remainingHours",width:100,valueType:"digit",render:e=>{const s=typeof e=="number"?e:0;return t.jsxs("span",{style:{color:s<0?"#FF4D4F":"#52C41A"},children:[s,"h"]})}},{title:"执行人",dataIndex:"assigneeName",width:120},{title:"所属机构",dataIndex:"organization",width:150},{title:"状态",dataIndex:"status",width:100,valueType:"select",valueEnum:{todo:{text:"待处理",status:"Default"},in_progress:{text:"进行中",status:"Processing"},completed:{text:"已完成",status:"Success"},cancelled:{text:"已取消",status:"Error"}},render:(e,s)=>t.jsx(B,{color:R(s.status),children:O(s.status)})},{title:"操作",valueType:"option",width:200,fixed:"right",render:(e,s)=>[t.jsx(u,{type:"link",size:"small",icon:t.jsx(_,{}),onClick:()=>S(s),children:"编辑"},"edit"),t.jsx(u,{type:"link",size:"small",danger:!0,icon:t.jsx(L,{}),onClick:F,children:"删除"},"delete")]}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"24px",position:"relative"},children:[t.jsx(u,{icon:t.jsx(V,{}),onClick:()=>l("/project"),style:{position:"absolute",left:0},children:"返回"}),t.jsx("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:a?(()=>{const e=b.find(s=>s.id===a);return e?`${e.name} - 任务管理`:"任务管理"})():"任务管理"})]}),t.jsx(M,{columns:P,actionRef:o,request:async()=>{const e=a?f.filter(s=>s.projectId===a):f;return{data:e,success:!0,total:e.length}},rowKey:"id",search:{labelWidth:"auto",defaultCollapsed:!1},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:a?"项目任务列表":"任务列表",toolBarRender:()=>[t.jsx(u,{type:"primary",icon:t.jsx(A,{}),onClick:T,children:"新增任务"},"add")],options:{density:!1,fullScreen:!1,reload:!0,setting:!1}}),t.jsx(y,{title:p?"编辑任务":"新增任务",open:I,onOk:C,onCancel:()=>d(!1),width:600,children:t.jsxs(i,{form:c,layout:"vertical",children:[t.jsx(i.Item,{name:"name",label:"任务名称",rules:[{required:!0,message:"请输入任务名称"}],children:t.jsx(g,{placeholder:"请输入任务名称"})}),t.jsx(i.Item,{name:"planHours",label:"计划工时",rules:[{required:!0,message:"请输入计划工时"}],children:t.jsx(g,{type:"number",placeholder:"请输入计划工时",step:.5})}),t.jsx(i.Item,{name:"assigneeId",label:"执行人",rules:[{required:!0,message:"请选择执行人"}],children:t.jsx(v,{placeholder:"请选择执行人",children:t.jsx(v.Option,{value:"3",children:"张三"})})})]})})]})};export{le as default};
